<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üí∞ Model Price Breakdown</title>

<style>
/* ================= GLOBAL SAFETY ================= */
html,body{
  width:100%;
  max-width:100%;
  overflow-x:hidden;
}

/* ================= THEME ================= */
:root{
  --primary:#1f2a44;
  --secondary:#2c3e50;
  --accent:#16a34a;
  --warn:#f59e0b;
  --bg:#f4f6f9;
  --card:#ffffff;
  --muted:#6b7280;
}

/* ================= RESET ================= */
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  min-width:0;
}

/* ================= BASE ================= */
body{
  font-family:'Segoe UI',Tahoma,Verdana,sans-serif;
  background:var(--bg);
  color:#111827;
  font-size:14px;
}

/* ================= HEADER ================= */
.header{
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  color:white;
  padding:14px;
}
.header-grid{
  display:grid;
  grid-template-columns:1fr;
  gap:10px;
}
.header-title{
  font-size:18px;
  font-weight:800;
  text-align:center;
  line-height:1.3;
  word-break:break-word;
}
.header-controls{
  display:grid;
  grid-template-columns:1fr;
  gap:8px;
}
.header-controls select,
.header-controls button{
  width:100%;
  padding:12px;
  border-radius:12px;
  font-size:15px;
}
.refresh-btn{
  background:var(--accent);
  color:white;
  border:none;
  font-weight:800;
  cursor:pointer;
}

/* ================= TABLET ================= */
@media(min-width:641px){
  .header-controls{grid-template-columns:2fr 1fr}
  .header-title{font-size:20px}
}

/* ================= DESKTOP ================= */
@media(min-width:1025px){
  .header-grid{
    grid-template-columns:auto 1fr;
    align-items:center;
  }
  .header-title{text-align:left}
  .header-controls{
    grid-template-columns:auto auto;
    justify-content:end;
  }
  .header-controls select{min-width:220px}
}

/* ================= MAIN ================= */
.main-container{
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
  padding:12px;
}

/* ================= PANELS ================= */
.panel{
  background:var(--card);
  border-radius:16px;
  padding:14px;
  box-shadow:0 8px 24px rgba(0,0,0,.08);
  overflow:hidden;
}
.panel-title{
  font-size:16px;
  font-weight:800;
  color:var(--primary);
  margin-bottom:10px;
}

/* ================= MODEL HEADER ================= */
.model-header{
  background:linear-gradient(135deg,#34495e,#2c3e50);
  color:white;
  padding:14px;
  border-radius:14px;
  margin-bottom:12px;
}
.model-name{font-size:18px;font-weight:800}
.model-code{font-size:13px;opacity:.9}

/* ================= SECTIONS ================= */
.detail-section{
  background:#f9fafb;
  padding:14px;
  border-radius:14px;
  margin-bottom:10px;
}

/* ================= TOP COLOUR ================= */
.top-colour{
  display:inline-flex;
  align-items:center;
  gap:6px;
  background:#fff7cc;
  color:#92400e;
  padding:6px 12px;
  border-radius:999px;
  font-weight:800;
  font-size:13px;
  border:1px solid var(--warn);
}

/* ================= COLORS ================= */
.color-list{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}
.color-item{
  padding:6px 12px;
  border-radius:999px;
  font-size:13px;
  background:#eef2ff;
  border:1px solid #c7d2fe;
}
.color-item.top{
  background:#fff7cc;
  border-color:var(--warn);
  font-weight:800;
}

/* ================= PRICE ================= */
.price-row{
  display:grid;
  grid-template-columns:1fr auto;
  gap:8px;
  padding:10px 0;
  border-bottom:1px dashed #e5e7eb;
}
.price-row:last-child{border:none}
.price-label{font-weight:600}
.price-value{
  font-weight:800;
  color:var(--primary);
  white-space:nowrap;
}
.price-total{
  font-size:18px;
  color:var(--accent);
}

/* ================= STATES ================= */
.loading,.empty,.error{
  text-align:center;
  padding:40px 20px;
  color:var(--muted);
}
.spinner{
  width:36px;
  height:36px;
  border:4px solid #e5e7eb;
  border-top:4px solid var(--primary);
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:0 auto 12px;
}
@keyframes spin{to{transform:rotate(360deg)}}
.error{
  background:#fee2e2;
  color:#b91c1c;
  border-left:6px solid #dc2626;
  border-radius:14px;
}

/* ================= DESKTOP PANELS ================= */
@media(min-width:1025px){
  .main-container{grid-template-columns:1fr 1fr}
}
</style>
</head>

<body>

<!-- ================= HEADER ================= -->
<div class="header">
  <div class="header-grid">
    <div class="header-title">üí∞ Model Price Breakdown</div>
    <div class="header-controls">
      <select id="modelSelect">
        <option value="">-- Select Vehicle --</option>
      </select>
      <button class="refresh-btn" onclick="loadData()">üîÑ Refresh</button>
    </div>
  </div>
</div>

<!-- ================= MAIN ================= -->
<div class="main-container">

  <div class="panel">
    <div class="panel-title">üöó Vehicle Information</div>
    <div id="leftContent" class="empty">Select a model</div>
  </div>

  <div class="panel">
    <div class="panel-title">üí∞ Price Breakdown</div>
    <div id="rightContent" class="empty">Select a model</div>
  </div>

</div>

<script>
const SHEET_ID="1MDe1sl4-HqF7oni4YiBFpetad4caffpZ9mGJvo8Kyeg";
const API_KEY="AIzaSyBvh5Tqt8uzJmc6XHcRte1t5CjU8olwrE8";
const SHEET_NAME="RAW_prices";

let data=[],selected=null;

/* ===== ROBUST TOP COLOR DETECTION ===== */
function getTopColor(row){
  return (
    row["Color As per Higher Aging"] ||
    row["COLOR AS PER HIGHER AGING"] ||
    row["Top Selling Color"] ||
    row["Top Selling Colour"] ||
    ""
  ).toString().trim();
}

async function loadData(){
  showLoading();
  try{
    const url=`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
    const res=await fetch(url);
    if(!res.ok) throw await res.text();
    const json=await res.json();
    const headers=json.values[0];

    data=json.values.slice(1).map(r=>{
      const o={};
      headers.forEach((h,i)=>o[h.trim()]=r[i]||"");
      return o;
    }).filter(r=>r["VEHICLE NAME"]);

    populateModels();
    reset();
  }catch(e){showError(e);}
}

function populateModels(){
  const models=[...new Set(data.map(r=>r["VEHICLE NAME"]))];
  modelSelect.innerHTML='<option value="">-- Select Vehicle --</option>'+
    models.map(m=>`<option value="${m}">${m}</option>`).join('');
  modelSelect.onchange=()=>selectModel(modelSelect.value);
}

function selectModel(name){
  selected=data.find(r=>r["VEHICLE NAME"]===name);
  if(!selected){reset();return;}
  renderLeft();
  renderRight();
}

function renderLeft(){
  const topColor=getTopColor(selected);
  const topLower=topColor.toLowerCase();

  leftContent.innerHTML=`
    <div class="model-header">
      <div class="model-name">${selected["VEHICLE NAME"]}</div>
      <div class="model-code">Model Code: ${selected["MODEL CODE"]||"N/A"}</div>
    </div>

    <div class="detail-section">
      <strong>Stock:</strong> ${selected.Stock||"N/A"}
    </div>

    <div class="detail-section">
      <div class="top-colour">
        ‚≠ê Top Selling Colour: ${topColor || "Not Available"}
      </div>
    </div>

    <div class="detail-section">
      <strong>Available Colors</strong>
      <div class="color-list">
        ${(selected.Color||"").split(",").map(c=>{
          const n=c.trim();
          if(!n) return "";
          return `
            <div class="color-item ${n.toLowerCase()===topLower?"top":""}">
              ${n}${n.toLowerCase()===topLower?" ‚≠ê":""}
            </div>`;
        }).join("")}
      </div>
    </div>`;
}

function renderRight(){
  rightContent.innerHTML=`
    <div class="detail-section">
      ${row("Ex-Showroom",selected["PRICE"])}
      ${row("Tax + Other",selected["TAXS+OTHER"])}
      ${row("Insurance (1+5)",selected["INSU 1+5 WITOUT ND"])}
      ${row("Accessories",selected["ACCE."])}
      ${row("Incidental",selected["Incidental charges"])}
      ${row("Goodlife",selected["GOODLIFE"])}
      ${row("Acc + Goodlife",selected["ACC+GOODLIFE"])}

      <div class="price-row">
        <div class="price-label">Total On-Road</div>
        <div class="price-value price-total">‚Çπ${fmt(selected["TOTAL"])}</div>
      </div>

      ${row("Hyp", selected["Hypothication"])}
      ${row("Total HP", selected["TOTAL HP"])}

    </div>`;
}

function row(label,value){
  return `
    <div class="price-row">
      <div class="price-label">${label}</div>
      <div class="price-value">‚Çπ${fmt(value)}</div>
    </div>`;
}

function fmt(v){
  return (+v||0).toLocaleString("en-IN");
}

function showLoading(){
  leftContent.innerHTML=rightContent.innerHTML=
    `<div class="loading"><div class="spinner"></div>Loading...</div>`;
}
function showError(e){
  leftContent.innerHTML=rightContent.innerHTML=
    `<div class="error">${e}</div>`;
}
function reset(){
  leftContent.innerHTML=rightContent.innerHTML="Select a model";
}

window.onload=loadData;
</script>

</body>
</html>

